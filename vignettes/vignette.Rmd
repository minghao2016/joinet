---
title: colasso
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

<!--
https://archive.ics.uci.edu/ml/datasets.html?format=&task=&att=&area=&numAtt=&numIns=&type=&sort=nameUp&view=list

https://en.wikipedia.org/wiki/List_of_datasets_for_machine_learning_research#Microbe
-->


```{r,eval=FALSE}
loss = NULL
for(rep in 1:4){
    set.seed(rep)
    
    #----- OBTAIN DATA -----
        
    ### simulated data ###
    #set.seed(rep)
    #n <- 100; p <- 1000
    #list <- colasso::colasso_simulate(p=p,n=n,cor="constant")
    #y <- list$y; X <- list$X
    
    ### mice data ###
    data(mice,package="BGLR")
    nsel <- sort(sample(seq_len(1814),size=1814,replace=FALSE))
    psel <- sort(sample(seq_len(10346),size=1000,replace=FALSE))
    y <- mice.pheno$Obesity.BMI[nsel] # try different phenotypes
    X <- mice.X[nsel,psel]
    
    ### wheat data ###
    #data(wheat,package="BGLR")
    #nsel <- seq_len(599)
    #psel <- seq_len(1279)
    #y <- as.numeric(wheat.Y[nsel,rep]) # try different phenotypes
    #X <- wheat.X[nsel,psel]
    
    #----- CROSS-VALIDATE -----
    
    loss <- rbind(loss,colasso_compare(y=y,X=X,nfolds.int=5))
    
}
```


# BBMRI DATA (important!)

```{r,eval=FALSE}
lib <- "/virdir/Scratch/arauschenberger/library"
.libPaths(lib)
devtools::install_github("rauschenberger/colasso",lib=lib)
setwd("/mnt/virdir/Scratch/arauschenberger/colasso")

utils::data(metabolomics_RP3RP4_overlap,package="BBMRIomics")
utils::data(rnaSeqData_ReadCounts_BIOS_cleaned,package="BBMRIomics")

# selecting samples
#colData(counts)[,"biobank_id"]
samples <- intersect(colnames(counts),colnames(metabolomicData))
Y <- t(SummarizedExperiment::assays(metabolomicData[,samples])$measurements)
X <- t(SummarizedExperiment::assay(counts[,samples]))

# selecting covariates
names <- spliceQTL::map.genes(chr=NULL)
X <- X[,colnames(X) %in% names$gene_id]

loss <- NULL
for(j in seq_len(ncol(Y))){
    # if(j < 2){next}
    cat("| j =",j,"|\n")
    y <- Y[,j]
    if(sd(y,na.rm=TRUE)==0){next}
    if(TRUE){
    #    psel <- sample(seq_len(56515),size=2000)
        nsel <- sample(seq_len(2003),size=500)
        y <- y[nsel]
        x <- X[nsel,] # psel
    }
    cond <- !is.na(y)
    y <- scale(y[cond])
    x <- x[cond,]
    loss <- rbind(loss,colasso::colasso_compare(y=y,X=x,nfolds=5))
}


```




```{r,eval=FALSE}
n <- 100; p <- 10
x <- matrix(rnorm(n*p),nrow=n,ncol=p)
y <- rbinom(n=n,size=1,prob=0.2)
a <- stats::glm(y~x,family="binomial")
y <- log(y/(1-y))
y[y==-Inf] <- -99e99
y[y==Inf] <- 99e99
b <- stats::glm(y~x,family="gaussian")
```


